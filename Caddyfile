{
	# Global options
	email support@openode.ai
}

# Production domain
openode.ai {
	encode gzip

	# WebSocket reverse proxy with upgrade headers
	reverse_proxy /ws* node:3000 {
		header_up Host {host}
		header_up X-Real-IP {remote}
		header_up X-Forwarded-For {remote}
		header_up X-Forwarded-Proto {scheme}
		header_up Connection {>Connection}
		header_up Upgrade {>Upgrade}
	}

	# HTTP reverse proxy for all other requests
	reverse_proxy /* node:3000 {
		header_up Host {host}
		header_up X-Real-IP {remote}
		header_up X-Forwarded-For {remote}
		header_up X-Forwarded-Proto {scheme}
	}

	# Security headers
	header {
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		X-XSS-Protection "1; mode=block"
		Referrer-Policy no-referrer-when-downgrade
	}
}

# Staging domain (for testing)
staging.openode.ai {
	encode gzip

	# Same configuration as production
	reverse_proxy /ws* node:3000 {
		header_up Host {host}
		header_up X-Real-IP {remote}
		header_up X-Forwarded-For {remote}
		header_up X-Forwarded-Proto {scheme}
		header_up Connection {>Connection}
		header_up Upgrade {>Upgrade}
	}

	reverse_proxy /* node:3000 {
		header_up Host {host}
		header_up X-Real-IP {remote}
		header_up X-Forwarded-For {remote}
		header_up X-Forwarded-Proto {scheme}
	}

	header {
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		X-XSS-Protection "1; mode=block"
		Referrer-Policy no-referrer-when-downgrade
	}
}